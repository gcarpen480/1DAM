{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "concesionario.schema.json",
    "title": "Concesionario de Coches",
    "description": "Gramatica para Concesionario",
    "type": "object",
    "properties": {
        "concesionario": {
            "type": "string",
            "description": "Nombre del concesionario"
        },
        "clientes": {
            "type": "array",
            "required": ["id","dni","nombre","direccion"],
            "additionalProperties": false,
            "description": "Listado de clientes",
            "items": {
                "type": "object",
                "properties": {
                    "id": {"id": {"$ref": "#/$defs/id_cliente"}},
                    "dni": {
                        "type": "string",
                        "description": "Documento de Identidad del Cliente"
                    },
                    "nombre":{
                        "type": "string",
                        "description": "Nombre del cliente"
                    },
                    "direccion":{
                        "type": "object",
                        "required":["domicilio","cp","poblacion"],
                        "additionalProperties": "false",
                        "description": "Direccion del cliente",
                        "properties":{
                            "domicilio": {
                                "type": "string",
                                "description": "Domicilio del cliente"
                            },
                            "cp": {
                                "type": "integer",
                                "minimum": 10000,
                                "maximum": 99999,
                                "description": "Codigo Postal del Cliente"   
                            },
                            "poblacion": {
                                "type": "string",
                                "description": "Poblacion del cliente"
                            }
                        }
                    }
                }
            }
        },
        "modelos": {
            "type": "array",
            "description": "Modelos de los coches",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "id": {"$ref": "#/$defs/id"}
                    },
                    "nombre": {
                        "type": "string",
                        "description": "Nombre del vehiculo"
                    },
                    "cilindrada": {
                        "type": "integer",
                        "description": "Cilindrada del vehiculo"
                    },
                    "cv": {
                        "type": "integer",
                        "description": "Caballos de vapor del vehiculo",
                        "minimum": "50"
                    },
                    "velmax": {
                        "type": "integer",
                        "description": "Velocidad maxima del vehiculo",
                        "minimum": "0"
                    },
                    "plazas": {
                        "type": "integer",
                        "description": "Numero de plazas del vehiculo",
                        "minimum": 4,
                        "maximum": 7
                    }
                },
                "required": ["id","nombre","cilindrada","cv","velmax","plazas"],
                "additionalProperties": false
            }
        },
        "coches": {
            "type": "array",
            "description": "Coches",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "id": {
                            "$ref": "#/$defs/id_modelo"
                        }
                    },
                    "modelo": {
                        "type": "integer",
                        "description": "Numero de modelo del vehiculo",
                        "minimum": 1
                    },
                    "tipo": {
                        "enum": [
                            "nuevo",
                            "2mano",
                            "km0"
                        ]
                    },
                    "km": {
                        "type": "integer",
                        "description": "Kilometros que tiene el vehiculo"
                    },
                    "reservado": {"id": {"$ref": "#/$defs/id_cliente"}}
                },
                "required": [
                    "id",
                    "modelo",
                    "tipo"
                ],
                "additionalProperties": false,
                "dependentRequired": {
                    "km": {
                        "type": "2mano"
                    }
                }
            }
        }
    },
    "$defs": {
        "id_modelo": {
            "type": "integer",
            "description": "Identificador unico del coche",
            "minimum": 1
        },
        "id_cliente":{
            "type": "integer",
            "description": "Identificador unico del Coche",
            "minimum": 1
        }
    }
}
